// app/src/main/java/com/arranquesuave/motorcontrolapp/utils/MqttConfig.kt
package com.arranquesuave.motorcontrolapp.utils

/**
 * Configuración central para MQTT
 */
object MqttConfig {
    
    // URLs de los brokers MQTT
    const val MQTT_LOCAL_URL = "tcp://192.168.1.12:1883"
    const val MQTT_REMOTE_URL = "tcp://177.247.175.4:1883"  // IP directa del profesor (temporal)
    
    // Para desarrollo/testing desde casa (broker público)
    const val MQTT_TEST_URL = "tcp://test.mosquitto.org:1883"
    
    // Topics para comandos (publicación)
    object CommandTopics {
        const val MOTOR_CONTROL = "motor/control/command"
        const val MOTOR_START = "motor/control/start"
        const val MOTOR_STOP = "motor/control/stop"
    }
    
    // Topics para telemetría (suscripción)
    object StatusTopics {
        const val MOTOR_SPEED = "motor/status/speed"
        const val MOTOR_CURRENT = "motor/status/current"
        const val MOTOR_VOLTAGE = "motor/status/voltage"
        const val MOTOR_STATE = "motor/status/state"
        const val MOTOR_TEMPERATURE = "motor/status/temperature"
    }
    
    // Configuración de conexión
    const val CONNECTION_TIMEOUT = 30
    const val KEEP_ALIVE_INTERVAL = 60
    const val QOS_LEVEL = 1
    const val CLEAN_SESSION = true
    const val AUTO_RECONNECT = true
    
    // Formato de Client ID
    fun generateClientId(): String = "MotorControlApp_${System.currentTimeMillis()}"
    
    // Lista de todos los topics de estado para suscripción
    fun getAllStatusTopics(): Array<String> = arrayOf(
        StatusTopics.MOTOR_SPEED,
        StatusTopics.MOTOR_CURRENT,
        StatusTopics.MOTOR_VOLTAGE,
        StatusTopics.MOTOR_STATE,
        StatusTopics.MOTOR_TEMPERATURE
    )
    
    // QoS para todos los topics
    fun getQosLevels(topicCount: Int): IntArray = IntArray(topicCount) { QOS_LEVEL }
    
    /**
     * Validar URL del broker
     */
    fun isValidBrokerUrl(url: String): Boolean {
        return url.startsWith("tcp://") || url.startsWith("ssl://")
    }
    
    /**
     * Obtener descripción legible del modo
     */
    fun getModeDescription(url: String): String = when (url) {
        MQTT_LOCAL_URL -> "WiFi Local (Casa del profesor)"
        MQTT_REMOTE_URL -> "WiFi Remoto (IP directa)"
        MQTT_TEST_URL -> "Modo Testing (Desarrollo)"
        else -> "Servidor personalizado"
    }
}
